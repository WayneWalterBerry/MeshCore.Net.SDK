# MeshCore Device Communication Protocol & Command Specifications

[\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol), [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol), [\[localmesh.nl\]](https://www.localmesh.nl/en/meshcore-cli-configuration/)

## Protocol Overview & Frame Structure

MeshCore’s companion devices communicate with host applications using a **binary, framed protocol** over serial (or BLE/WiFi) connections. Each message (command or response) is encapsulated in a frame that includes specific delimiter bytes, length encoding, and payload content: [\[deepwiki.com\]](https://deepwiki.com/meshcore-dev/MeshCore/4.1.1-command-protocol), [\[deepwiki.com\]](https://deepwiki.com/meshcore-dev/MeshCore/4.1.1-command-protocol)

*   **Frame Delimiters:** On a USB serial link, every outbound frame from the device begins with byte `0x3E` (ASCII `'>'`), and every inbound frame from the app begins with `0x3C` (ASCII `'<'`). These start-of-frame markers help each side distinguish the direction and start of a message. In other words, the app should prefix each command frame with `<0x3C>` and the device will prefix responses with `<0x3E>`. (On BLE, frames are inherently delimited by BLE packets, so explicit markers aren’t needed.) [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol)

*   **Length Encoding:** Following the start byte, **two bytes** indicate the length of the payload (in **little-endian** order). For example, if an app sends a command with a 2-byte payload, it would send `0x3C 0x02 0x00 ...` (where `0x0002` = 2). All multi-byte integers in the protocol use little-endian byte order. The length field covers only the payload bytes (not counting the delimiter or length bytes themselves). The **maximum payload size** is typically 255 bytes (0x00FF) in current firmware, aligning with an overall frame size limit of 255 + 3 bytes overhead. [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol) [\[deepwiki.com\]](https://deepwiki.com/meshcore-dev/MeshCore/4.1.1-command-protocol)

*   **Payload Structure:** The first byte of the payload is always a **“command code”** or **“response code”** identifying what kind of message it is. Any subsequent bytes in the payload are parameters or data for that command/response. All frames use a consistent format, so the device firmware reads the start byte, then the length, then processes the payload bytes accordingly. [\[deepwiki.com\]](https://deepwiki.com/meshcore-dev/MeshCore/4.1.1-command-protocol), [\[deepwiki.com\]](https://deepwiki.com/meshcore-dev/MeshCore/4.1.1-command-protocol)

**Example – Device Query Frame:** To illustrate, suppose the host application wants to query the device’s identity and capabilities. The app would send a frame:

*   Start byte `0x3C` (indicating “app->device” frame). [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol)
*   Length bytes: e.g. `0x02 0x00` for a 2-byte payload.
*   Payload: `0x16 0x08` where `0x16` is the **CMD\_DEVICE\_QUERY** command code (22 in decimal) and `0x08` is the protocol version that the app supports (in this example, 8). Here the app is informing the device that it speaks protocol version 8. [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol)

The device, upon receiving this, recognizes the `<` start byte and reads 2 payload bytes. It sees command `0x16` (22) which corresponds to a Device Query, and the next byte `0x08` as the version indicator. It then responds with its own frame:

*   Start byte `0x3E` (device->app). [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol)
*   Length bytes for the response payload (will depend on how much data is returned).
*   Payload starting with code `0x0D` (13 in decimal), which is **RESP\_CODE\_DEVICE\_INFO**, followed by fields containing the device’s firmware version, build date, model name, etc. (see *Command & Response Set* below for details). [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol), [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol)

In summary, the MeshCore companion protocol uses a simple but robust framing: **`0x3C/0x3E` start flags + 16-bit length + data**, which ensures that communication is synchronized and each message’s boundaries are known. This frame format is consistent across USB serial, and similar framing is applied for BLE and Wi-Fi interfaces (though the transport may handle some aspects like packetization automatically). [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol), [\[deepwiki.com\]](https://deepwiki.com/meshcore-dev/MeshCore/4.1.1-command-protocol) [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol)

## Serial Communication Details

**Connection Parameters:** MeshCore companion devices present themselves as a USB serial (CDC) interface. The standard default **baud rate is 115200 bps** (8 data bits, no parity, 1 stop bit). In practice, since USB CDC abstracts the baud, you typically just open the COM port at 115200/N/8/1. No special flow control or custom drivers are needed – it appears as a regular serial port. The device’s firmware initializes the serial port at 115200 baud on startup, so the host should use the same speed. [\[deepwiki.com\]](https://deepwiki.com/ripplebiz/MeshCore/10.3-troubleshooting)

**Initiating Communication:** Once connected, the **MeshCore companion device acts as a passive server** waiting for commands. It does not automatically send identification or a prompt on connect (unlike some devices that might print a banner). In fact, *“the companion radio essentially takes the 'server' role, and just responds to requests from the connected app (the 'client')”*. This means the host should send a command frame to begin any interaction (see Handshake below). If you open the serial port and listen without sending anything, the device will remain mostly silent (aside from asynchronous notifications if certain events occur, discussed later). [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol)

**Device Identification & Handshake:** The very first step is usually to **query the device’s identity** and ensure the protocol versions match. MeshCore defines two primary handshake commands that the app should use immediately after opening the connection:

*   **CMD\_DEVICE\_QUERY (0x16)** – *Device Query.* According to documentation, *“This should be the first command the app sends after establishing connection”*. Its payload includes a version byte so the app can tell the device what protocol version it supports. The device will reply with **RESP\_CODE\_DEVICE\_INFO (0x0D)** containing its firmware version, model, and capabilities. This exchange helps “negotiate” features – the device can adjust responses if the app is older/newer (backward compatibility). Indeed, the firmware notes that the app’s version (sent in CMD\_DEVICE\_QUERY) is stored internally to handle compatibility differences. [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol) [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol), [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol) [\[deepwiki.com\]](https://deepwiki.com/meshcore-dev/MeshCore/4.1.1-command-protocol)

*   **CMD\_APP\_START (0x01)** – *App Start.* This is an alternative initial command (used in older protocol flows). The docs say *“the app start command should be the first request the app sends to the radio”*, which triggers the device to respond with **RESP\_CODE\_SELF\_INFO (0x05)** – essentially the device’s current status/configuration. The CMD\_APP\_START frame typically includes the application’s name/version in its payload (8 bytes reserved + name string). In newer firmware, CMD\_APP\_START is often sent **after** the Device Query, but in older firmware it may be expected **before** other commands. (In practice, if one isn’t recognized, try the other – see **Troubleshooting** below.) [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol), [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol)

In summary, to **enumerate or “discover” a MeshCore companion device on a COM port**, the host should send one of these handshake commands (Device Query is the primary method in the latest protocol). A successful response means the device is a MeshCore companion and is ready for further commands. If you get no response at all, double-check the COM port and baud; if you get an error response (`InvalidCommand`), the device might be running a different firmware or an older protocol version (explained later).

**Response Format and Status Codes:** All commands sent by the app will receive some form of response frame from the device. The first byte of any response payload is a **response code**. Key response codes include:

*   **0x00 – RESP\_CODE\_OK:** Generic success acknowledgment. This code means the preceding command was executed successfully and there’s no additional data to return (just the 0x00 as the payload).

*   **0x01 – RESP\_CODE\_ERR:** Generic error response. This indicates the command failed or was not accepted. In this case, an *error code* byte usually follows to explain why. For example, if the device didn’t recognize the command code, it might return an error code `0x01` meaning “Invalid Command” (within the error frame). Other error subcodes exist for things like illegal arguments, etc. So an error response frame looks like `[0x3E] length=2 [0x01 0x??]`, where `0x??` is the specific error reason.

*   **Other Response Codes (data-bearing):** Many responses carry data and use codes above 0x01. For instance, **0x05 – RESP\_CODE\_SELF\_INFO** contains the node’s status/info (in response to CMD\_APP\_START), and **0x0D – RESP\_CODE\_DEVICE\_INFO** contains detailed device info (firmware version, build date, model name, etc., in response to CMD\_DEVICE\_QUERY). There are also response codes for specific data: e.g. **0x09 – RESP\_CODE\_CURR\_TIME** returns the current device clock time (reply to CMD\_GET\_DEVICE\_TIME), **0x0C – RESP\_CODE\_BATT\_AND\_STORAGE** returns battery voltage and storage stats (reply to CMD\_GET\_BATT\_AND\_STORAGE), **0x06 – RESP\_CODE\_SENT** indicates a message was queued/sent (in response to a send message command), and so on. We will detail many of these in the sections below. [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol), [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol) [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol)

*   **Asynchronous Notifications:** The device can also send *unsolicited* frames with **“PUSH\_CODE”** values (0x80 and above) to notify the app of events (like an incoming message or network update). For example, `0x83 – PUSH_CODE_MSG_WAITING` tells the app that a new message arrived (prompting the app to fetch it). These are not responses to a command, but rather spontaneous messages. They will use the 0x3E start byte as well, since they originate from the device. [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol), [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol) [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol)

**Unknown or Invalid Commands:** If the host sends a command code that the device firmware doesn’t understand or isn’t supported in its current mode, the typical behavior is to return a **RESP\_CODE\_ERR (0x01)** with an error subcode indicating an invalid command. In other words, the device won’t ignore unknown commands silently – it will actively respond with an error frame to signal “I received your frame but the command ID is not recognized.” This is exactly what you observed with command 22 on your device (an “InvalidCommand” response). We’ll address how to resolve this in the **Troubleshooting** section.

Finally, note that the MeshCore companion protocol does **not require periodic “ping” messages** to keep the connection alive. If no commands are sent, the link stays idle (over USB this is fine). There is a command for checking connection to a mesh server (`CMD_HAS_CONNECTION`, code 0x1C) if the device is linked to a server, but on the direct serial link, you typically know the connection is fine if you can get any response. A simple no-op command (like asking for time or status) can serve as a ping if needed.

## MeshCore Command Set and Values

MeshCore defines a rich set of **command codes (CMD\_\*)** that the host application can send to a companion device, as well as corresponding **response codes (RESP\_CODE\_\*)** that the device uses to reply. Each command code is a single byte (0x01–0x38, 0x25–0x56, etc., non-contiguous), and many have mnemonic names. Below is a summary of known commands, their byte values, purpose, and typical response or effect. The commands can be grouped by function (core device commands, configuration, contact management, network operations, etc.). All commands are sent from app to device with the 0x3C frame prefix, and responses come back with 0x3E prefix.

### Core & Device Commands (Identification, Status, Basic Control)

These commands deal with identifying the device, initial handshakes, and basic device info or control operations:

| **Code (Hex)** | **Command Name**                 | **Description**                                                                                                                                                                                                                                                                                                                                                                          | **Expected Response**                                                                                                                                                                                                                                                                                                                                                                              |
| -------------- | -------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 0x01           | **CMD\_APP\_START**              | Begin app session. Host provides its app version and name. Used to initialize communication (especially in older protocol flows). *Payload:* 1 byte app version + 6 bytes reserved + app name string [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol), [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol). | **RESP\_CODE\_SELF\_INFO** (0x05) – Device’s own info (node settings, radio parameters, etc.) [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol), [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol). Contains public key, coordinates, power settings, name, etc.                                                     |
| 0x16           | **CMD\_DEVICE\_QUERY**           | Query device info and capabilities. This is typically sent at start to get firmware details and negotiate protocol version. *Payload:* 1 byte indicating app’s supported protocol version [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol).                                                                                                      | **RESP\_CODE\_DEVICE\_INFO** (0x0D) – Device identification info [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol), [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol). Includes firmware version code, max contacts/channels (if applicable), BLE PIN (if any), build date, model/name, and semantic version string. |
| 0x05           | **CMD\_GET\_DEVICE\_TIME**       | Request the current real-time clock time from the device. No additional payload (or optionally a placeholder) [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol).                                                                                                                                                                                  | **RESP\_CODE\_CURR\_TIME** (0x09) – returns current device time as a 32-bit Unix timestamp (UTC seconds) [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol).                                                                                                                                                                                                 |
| 0x06           | **CMD\_SET\_DEVICE\_TIME**       | Set the device’s RTC clock. *Payload:* 4-byte UNIX timestamp (little-endian).                                                                                                                                                                                                                                                                                                            | **RESP\_CODE\_OK** (0x00) on success, or **RESP\_CODE\_ERR** (0x01) if the time could not be set [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol).                                                                                                                                                                                                         |
| 0x07           | **CMD\_SEND\_SELF\_ADVERT**      | Instruct device to broadcast its “advertisement” (identification packet) into the mesh. Essentially forces an immediate beacon. *Payload:* 1 byte (optional mode, e.g. 1 for flood mode, 0 for one-hop) [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol).                                                                                        | **RESP\_CODE\_OK** (0x00) if the advert was queued for sending, **RESP\_CODE\_ERR** (0x01) on failure [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol).                                                                                                                                                                                                    |
| 0x08           | **CMD\_SET\_ADVERT\_NAME**       | Set the public “node name” used in the device’s advertisement packets (for identification). *Payload:* new name string (UTF-8) after the command byte [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol).                                                                                                                                          | **RESP\_CODE\_OK** (0x00) if name was updated successfully [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol).                                                                                                                                                                                                                                               |
| 0x14           | **CMD\_SET\_ADVERT\_LATLON**     | Update the device’s advertised latitude/longitude. *Payload:* 4-byte latitude \*1e6 + 4-byte longitude \*1e6 (and optional altitude) [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol).                                                                                                                                                           | **RESP\_CODE\_OK** (0x00) on success, or **RESP\_CODE\_ERR** (0x01) if arguments are invalid [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol).                                                                                                                                                                                                             |
| 0x13           | **CMD\_RESET\_PATH**             | Reset the stored mesh routing path for a given contact. *Payload:* contact’s public key (or identifier) whose path should be cleared from memory [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol).                                                                                                                                               | **RESP\_CODE\_OK** if path was reset, or **RESP\_CODE\_ERR** if contact not found/invalid [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol).                                                                                                                                                                                                                |
| 0x19           | **CMD\_REBOOT**                  | Reboot the device. *Payload:* the ASCII letters "reboot" (0x72 65 62 6F 6F 74) following the command code [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol), [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol).                                                                                            | *No response.* The device will restart immediately if it accepts this command [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol). (Use with caution; the serial port will disconnect.)                                                                                                                                                                       |
| 0x20           | **CMD\_GET\_BATT\_AND\_STORAGE** | Request battery voltage and storage usage info. No extra payload (just the command) [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol).                                                                                                                                                                                                            | **RESP\_CODE\_BATT\_AND\_STORAGE** (0x0C) – returns battery level (mV) and storage stats (e.g. free/used space) [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol).                                                                                                                                                                                          |
| 0x21           | **CMD\_SET\_TUNING\_PARAMS**     | Set advanced radio “tuning” parameters (e.g. timing tweaks). *Payload:* structure of tuning values (implementation-specific).                                                                                                                                                                                                                                                            | **RESP\_CODE\_OK** (0x00) on success, or **RESP\_CODE\_ERR** (0x01) if parameter out of range. A subsequent **RESP\_CODE\_TUNING\_PARAMS** may be used for confirming settings in some versions [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol).                                                                                                          |
| 0x38           | **CMD\_SET\_OTHER\_PARAMS**      | Set miscellaneous configuration parameters not covered by other commands. Payload format varies depending on firmware (could include various flags/settings) [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol).                                                                                                                                   | **RESP\_CODE\_OK** (0x00) on success, or **RESP\_CODE\_ERR** (0x01) if unsupported or invalid.                                                                                                                                                                                                                                                                                                     |

**Notes:** The Device Query (0x16) and App Start (0x01) are crucial for initial communication – they retrieve device info and set up the session. It’s good practice to send **CMD\_DEVICE\_QUERY** first to ensure version compatibility, then **CMD\_APP\_START** to get node details, although some apps might do only one or the other depending on firmware expectations. Many of the basic commands (time, name, location, etc.) simply return an OK or error, since the host already knows the context (for example, after setting time there’s no further data needed, just an acknowledgment). [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol)

### Radio & Config Commands

These commands relate to radio hardware settings and other configuration that affects how the device operates in the mesh network:

| **Code (Hex)** | **Command Name**               | **Description**                                                                                                                                                                                                                                                                                             | **Expected Response**                                                                                                                                                                                                                                                                                                                                                                                        |
| -------------- | ------------------------------ | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| 0x0B           | **CMD\_SET\_RADIO\_PARAMS**    | Save new radio parameters (frequency, spreading factor, etc.) to device storage. *Payload:* structured radio config (frequency, bandwidth, etc.) [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol).                                                                  | **RESP\_CODE\_OK** if parameters were saved, or **RESP\_CODE\_ERR** on failure (e.g., invalid values) [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol).                                                                                                                                                                                                              |
| 0x0C           | **CMD\_SET\_RADIO\_TX\_POWER** | Set the radio transmit power level. *Payload:* 1 byte power level (in dBm).                                                                                                                                                                                                                                 | **RESP\_CODE\_OK** on success, **RESP\_CODE\_ERR** if out of range or not applicable [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol).                                                                                                                                                                                                                               |
| 0x15           | **CMD\_REMOVE\_CONTACT**       | Remove a stored contact from the device’s address book. *Payload:* identifier (e.g. public key prefix) of the contact to remove [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol).                                                                                   | **RESP\_CODE\_OK** if contact removed, **RESP\_CODE\_ERR** if not found [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol).                                                                                                                                                                                                                                            |
| 0x11           | **CMD\_SET\_RADIO\_PARAMS**    | *(Duplicate listing – see 0x0B, likely the same; 0x0B and 0x0B in doc might be a formatting issue)* Configure radio parameters (frequency, etc.).                                                                                                                                                           | **RESP\_CODE\_OK** or **ERR** as above.                                                                                                                                                                                                                                                                                                                                                                      |
| 0x12           | **CMD\_SET\_RADIO\_TX\_POWER** | *(Duplicate listing, see 0x0C above.)* Set TX power.                                                                                                                                                                                                                                                        | **RESP\_CODE\_OK** or **ERR** as above.                                                                                                                                                                                                                                                                                                                                                                      |
| 0x17           | **CMD\_EXPORT\_CONTACT**       | Export a contact’s advertisement (business card). If a specific contact is given, returns that contact’s advert data; if none given, creates a new self-advert. *Payload:* optional contact public key (or empty). [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol) | **RESP\_CODE\_EXPORT\_CONTACT** (0x0B) with the contact’s advert data if successful, or **RESP\_CODE\_ERR** (0x01) on failure [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol). The returned advert bytes can be saved or shared.                                                                                                                                    |
| 0x18           | **CMD\_IMPORT\_CONTACT**       | Import a contact from an advert blob. *Payload:* raw bytes previously obtained from CMD\_EXPORT\_CONTACT (including the advert packet). [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol)                                                                            | **RESP\_CODE\_OK** if the contact was added successfully, or **RESP\_CODE\_ERR** if the data was invalid [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol). On success, the device may also generate a **PUSH\_CODE\_NEW\_ADVERT** event as if a new contact was discovered [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol). |
| 0x51           | **CMD\_FACTORY\_RESET**        | **Dangerous:** Erase the device’s filesystem and reset its identity to factory defaults. *Payload:* the ASCII string "reset" after the command byte (acts as a confirmation).                                                                                                                               | **RESP\_CODE\_OK** if the reset command was accepted (after which the device will likely reboot and require re-provisioning), or **RESP\_CODE\_ERR** if something prevented the reset. (In most cases, no explicit response before reboot.)                                                                                                                                                                  |

*Notes:* Most radio parameter changes take effect immediately or on next radio initialization, and are stored in non-volatile memory. Changing frequency or power on the fly will affect mesh connectivity, so use those commands with understanding of the network. The **contact import/export** commands (0x17, 0x18) facilitate transferring contacts between devices (e.g., exchanging “business cards” offline) and are a bit more advanced. **Factory reset (0x51)** is typically used only when re-configuring a device from scratch; it ensures all data (keys, messages, contacts) are wiped.

### Messaging & Contact Management Commands

These commands involve sending messages to other nodes, managing the device’s contact list, and channel communication:

| **Code (Hex)** | **Command Name**                 | **Description**                                                                                                                                                                                                                                                                                                                                                                  | **Expected Response**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| -------------- | -------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| 0x02           | **CMD\_SEND\_TXT\_MSG**          | Send a text message (private) to a specific contact. *Payload:* typically includes the recipient’s ID (public key or index) and the message content. [\[deepwiki.com\]](https://deepwiki.com/meshcore-dev/MeshCore/4.1.1-command-protocol)                                                                                                                                       | **RESP\_CODE\_SENT** (0x06) – indicates the message was handed to the mesh for delivery, along with a 32-bit “ACK code” for tracking [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol). If the send fails immediately, RESP\_CODE\_ERR is returned. Later, if the message is acknowledged by the recipient, the device will send a **PUSH\_CODE\_SEND\_CONFIRMED** (0x82) asynchronously with the ACK code and round-trip time [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol).                                                                                                                                                                                                                                                                                                                |
| 0x03           | **CMD\_SEND\_CHANNEL\_TXT\_MSG** | Send a channel (group) text message. This is a broadcast/flood message to a communication channel (all nodes listening on that channel). *Payload:* includes the channel ID and message content. [\[deepwiki.com\]](https://deepwiki.com/meshcore-dev/MeshCore/4.1.1-command-protocol), [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol) | **RESP\_CODE\_OK** (0x00) if the message was queued for broadcast, or **RESP\_CODE\_ERR** if it failed to send [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol). (Channel messages typically are not acknowledged individually by recipients, since they are broadcast.)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| 0x04           | **CMD\_GET\_CONTACTS**           | Request the list of contacts (nodes) stored on the device. Optionally, a timestamp can be included to get only contacts updated since that time [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol). *Payload:* either none or a 4-byte “since” timestamp.                                                                                  | The device will respond with a **sequence** of frames: **RESP\_CODE\_CONTACTS\_START** (0x02) to mark the beginning, then one or more **RESP\_CODE\_CONTACT** frames (0x03) each carrying a contact’s details, and finally **RESP\_CODE\_END\_OF\_CONTACTS** (0x04) to mark completion [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol). Each contact frame typically includes name, public key, last seen info, etc.                                                                                                                                                                                                                                                                                                                                                                                                                  |
| 0x09           | **CMD\_ADD\_UPDATE\_CONTACT**    | Add a new contact or update an existing contact’s details. *Payload:* the full contact info (likely \~83 bytes containing the contact’s public key, nickname, etc.) [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol).                                                                                                                    | **RESP\_CODE\_OK** if the contact was stored/updated, **RESP\_CODE\_ERR** if there was an issue (e.g., memory full or invalid data) [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol). If successful and it’s a new contact, the device might then treat it as if an advert was received.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| 0x15           | **CMD\_REMOVE\_CONTACT**         | *(Listed above in config as well.)* Remove a contact. *Payload:* identifier (partial public key).                                                                                                                                                                                                                                                                                | **RESP\_CODE\_OK** or **ERR**, as described earlier [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| 0x16           | **CMD\_SHARE\_CONTACT**          | Share a contact’s advert with others. This causes the device to transmit a given contact’s advertisement (like forwarding someone else’s contact). *Payload:* the contact’s public key to share [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol).                                                                                        | **RESP\_CODE\_OK** on success (meaning the advert packet was sent), **RESP\_CODE\_ERR** if the contact isn’t found [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| 0x10           | **CMD\_SYNC\_NEXT\_MESSAGE**     | Retrieve the next incoming message from the device’s queue. The companion device can queue messages (received while app was offline). Each call to this command pops one message. No payload needed [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol).                                                                                    | If there are no messages waiting, **RESP\_CODE\_NO\_MORE\_MESSAGES** (0x0A, decimal 10) is returned [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol). If a message is available, you’ll get either **RESP\_CODE\_CONTACT\_MSG\_RECV** (0x07) for a direct message or **RESP\_CODE\_CHANNEL\_MSG\_RECV** (0x08) for a channel message, containing the message data [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol). In newer protocol versions (v3+), the device instead uses codes 0x10 (16) and 0x11 (17) for contact and channel messages with an updated format [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol). After processing the message, the host can call CMD\_SYNC\_NEXT\_MESSAGE again until RESP\_CODE\_NO\_MORE\_MESSAGES is received. |

*Notes:* The **send message** commands (0x02, 0x03) involve the mesh networking functionality – the device will propagate the message through the mesh. The RESP\_CODE\_SENT (6) response signals that the message was handed off to the mesh network successfully. Actual delivery confirmations come asynchronously via push notifications (since delivery may take time). The **contact list synchronization** (CMD\_GET\_CONTACTS) is a multi-step response as noted; the host should collect contacts until it sees the END\_OF\_CONTACTS code. **CMD\_SYNC\_NEXT\_MESSAGE** is typically triggered either on a push notification of waiting messages (PUSH\_CODE\_MSG\_WAITING, 0x83) or at connect to fetch any backlog. The difference between older and newer protocol versions for message receipts (0x07/0x08 vs 0x10/0x11 hex) is handled automatically if you indicated your version in CMD\_DEVICE\_QUERY – the device will choose which to use based on the app’s protocol version. [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol)

### Network Operations & Advanced Commands

These commands are used for interacting with network infrastructure (repeaters/servers), performing diagnostics, or sending non-text data:

| **Code (Hex)** | **Command Name**                    | **Description**                                                                                                                                                                                                                                                                                                                | **Expected Response**                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| -------------- | ----------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 0x1A           | **CMD\_SEND\_LOGIN**                | Send a login request to a mesh *Room Server* or repeater (for joining a network room). Typically used when the device acts as a client to a server. *Payload:* login credentials or request parameters. [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol)                               | **RESP\_CODE\_SENT** (0x06) with an estimated timeout if the login request was transmitted [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol). Later, a push notification will indicate the result: **PUSH\_CODE\_LOGIN\_SUCCESS** (0x85) or **PUSH\_CODE\_LOGIN\_FAIL** (0x86) will arrive once the server responds [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol).                    |
| 0x1B           | **CMD\_SEND\_STATUS\_REQ**          | Send a status request to another node (e.g., a sensor or repeater) to query its status. *Payload:* target node identifier. [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol)                                                                                                            | **RESP\_CODE\_SENT** (0x06) if the request was sent out [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol). When/if the target replies, the companion will emit a **PUSH\_CODE\_STATUS\_RESPONSE** (0x87) containing the status data from that node [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol).                                                                                     |
| 0x1C           | **CMD\_HAS\_CONNECTION**            | Check if there is an active connection to a server (perhaps used if the device can connect to an Internet gateway). *Payload:* none (or small flag).                                                                                                                                                                           | **RESP\_CODE\_OK** with a byte indicating connection status, or **RESP\_CODE\_ERR** if not applicable. (This command is mentioned in code as a way to check connection but may not appear in all firmware; it’s likely used internally or for UI.)                                                                                                                                                                                                                      |
| 0x1D           | **CMD\_LOGOUT**                     | Disconnect from the current Room Server (logout). Essentially instructs the device to drop the server connection.                                                                                                                                                                                                              | **RESP\_CODE\_OK** if the device disconnected (or no connection existed), possibly followed by a push or change in status, or **RESP\_CODE\_ERR** if not connected. (In code it is listed as 0x1D = logout).                                                                                                                                                                                                                                                            |
| 0x25           | **CMD\_SEND\_RAW\_DATA**            | Send a custom binary packet into the mesh (for user-defined payloads). *Payload:* includes target node and raw payload bytes, marked as a custom type in MeshCore protocol [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol).                                                           | **RESP\_CODE\_OK** (0x00) if queued, or **RESP\_CODE\_ERR** if failed [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol). If the target node receives it, the host might get a **PUSH\_CODE\_RAW\_DATA** (0x84) indicating a raw packet was received [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol).                                                                                    |
| 0x24           | **CMD\_SEND\_PATH\_DISCOVERY\_REQ** | Initiate a path discovery procedure to a given node. This asks the mesh to find a route to the target without actually sending a message. *Payload:* target node ID and perhaps parameters.                                                                                                                                    | **RESP\_CODE\_SENT** (0x06) if the request was sent. When the path discovery completes, the device will send **PUSH\_CODE\_PATH\_DISCOVERY\_RESPONSE** (0x8D) containing the discovered route or failure info.                                                                                                                                                                                                                                                          |
| 0x36           | **CMD\_SEND\_TRACE\_PATH**          | Send a trace route request. This causes a special “trace” packet to go through the mesh and collect signal data. *Payload:* target node ID and a random 32-bit tag to identify this trace [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol).                                            | **RESP\_CODE\_SENT** (0x06) if the trace was launched [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol). When the trace completes, the device will send **PUSH\_CODE\_TRACE\_DATA** (0x89) containing the path and SNR data for each hop [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol), [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol).     |
| 0x27           | **CMD\_SEND\_TELEMETRY\_REQ**       | Request telemetry data from a specific node. For example, ask a sensor node for its readings. *Payload:* target node ID (and what data is needed, depending on implementation) [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol).                                                       | **RESP\_CODE\_SENT** (0x06) if the request was sent out [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol). When the target responds, the app will get **PUSH\_CODE\_TELEMETRY\_RESPONSE** (0x8B) with the telemetry info [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol). *(Note: Newer firmware might use CMD\_SEND\_BINARY\_REQ instead for a generalized binary request mechanism.)* |
| 0x32           | **CMD\_GET\_CHANNEL**               | Get details of a specific channel (group) that the device knows about. *Payload:* channel ID or index.                                                                                                                                                                                                                         | **RESP\_CODE\_CHANNEL\_INFO** (likely code 0x?? – not explicitly in snippet above, possibly 0x13 or similar) containing channel parameters (like frequency or members). Or **RESP\_CODE\_ERR** if channel not known.                                                                                                                                                                                                                                                    |
| 0x33           | **CMD\_SET\_CHANNEL**               | Configure a group channel (e.g. create or update channel settings like encryption). *Payload:* channel configuration data.                                                                                                                                                                                                     | **RESP\_CODE\_OK** on success or **RESP\_CODE\_ERR** on failure (e.g., invalid config).                                                                                                                                                                                                                                                                                                                                                                                 |
| 0x28           | **CMD\_HAS\_CONNECTION**            | *(See 0x1C above, duplicate listing; appears in code references as 0x1C/0x28, possibly a mistake in documentation indexing.)*                                                                                                                                                                                                  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| 0x39           | **CMD\_SEND\_TELEMETRY\_REQ**       | *(Duplicate listing, see 0x27 above; 0x27 and 0x39 likely serve similar purpose, perhaps version differences.)*                                                                                                                                                                                                                |                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| 0x50           | **CMD\_SEND\_BINARY\_REQ**          | Send a binary request to a node (more general form of telemetry request introduced in newer versions). This can be thought of as a user-defined remote procedure call with a custom payload. *Payload:* target node and request data. [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol) | **RESP\_CODE\_SENT** (0x06) with a tag and timeout if dispatched [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol). The response from the target, when it arrives, will cause a **PUSH\_CODE\_BINARY\_RESPONSE** (0x8C) to be sent to the app containing the reply data [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol).                                                                |
| 0x54           | **CMD\_SET\_FLOOD\_SCOPE**          | Configure the regional flood scope for broadcasts. Possibly sets how far (in hops or region) a flood message should propagate. *Payload:* scope parameters.                                                                                                                                                                    | **RESP\_CODE\_OK** if applied or **RESP\_CODE\_ERR** if not. (Effect is on how the device will handle flood messages.)                                                                                                                                                                                                                                                                                                                                                  |
| 0x55           | **CMD\_SEND\_CONTROL\_DATA**        | Send a control packet into the mesh. This might be used for low-level control commands or non-user data. *Payload:* control packet content and addressing info [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol).                                                                       | **RESP\_CODE\_OK** if the packet was transmitted, **RESP\_CODE\_ERR** if not [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol). If a node receives such a control packet, the companion may emit a **PUSH\_CODE\_CONTROL\_DATA** (0x8E) event to the app.                                                                                                                                                                        |
| 0x56           | **CMD\_GET\_STATS**                 | Retrieve internal statistics from the device (operation counters, performance metrics). *Payload:* 1 byte specifying which stats (0=core, 1=radio, 2=packets, etc.) [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol).                                                                  | **RESP\_CODE\_STATS** (0x18, decimal 24) – returns a structured data set with the requested statistics [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol).                                                                                                                                                                                                                                                                        |

*Notes:* The *network operation* commands (0x1A, 0x1B, etc.) are relevant if your MeshCore device is participating in a larger network with repeaters or servers. For example, **CMD\_SEND\_LOGIN** and **LOGOUT** are used only if the device connects to a managed “room server” (which might require login); not all use cases involve those. Many of these commands result in an **immediate 0x06 (SENT)** response and then an asynchronous push when the real outcome comes back later from the mesh. This decoupling is typical in mesh networks due to latency.

**Command Code Ranges:** As the tables show, MeshCore command codes are not in one simple sequential range – they span multiple ranges with gaps. For instance, core commands occupy low numbers (0x01–0x0A range, with some gaps), configuration commands extend into the teens and 20s, and some high-level or newer commands use codes in the 0x30–0x38 and 0x50+ range. The current highest command code in firmware is 0x56 (CMD\_GET\_STATS). Values like 0x22 (34) or 0x23 (35) were not assigned in the protocol, and are unused/reserved. Always refer to the official documentation or header files for exact code definitions. [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol)

### Response Codes Summary

For completeness, here is a brief summary of **common response codes** (device-to-app), many of which were mentioned above:

*   **0x00 – RESP\_CODE\_OK:** Generic success acknowledgment (no error).
*   **0x01 – RESP\_CODE\_ERR:** Generic failure; an error code byte follows to specify the error. Known error sub-codes include **0x01** = InvalidCommand (command not recognized) and **0x02** = IllegalArgument (bad payload/parameter) – these are inferred from usage. [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol)
*   **0x02 – RESP\_CODE\_CONTACTS\_START:** Beginning of contacts list (response to CMD\_GET\_CONTACTS). [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol)
*   **0x03 – RESP\_CODE\_CONTACT:** Contact data entry (as part of contacts list or a push new advert) – contains one contact’s info.
*   **0x04 – RESP\_CODE\_END\_OF\_CONTACTS:** Terminator for contacts list. [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol)
*   **0x05 – RESP\_CODE\_SELF\_INFO:** Device’s own info (node settings), returned after CMD\_APP\_START. [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol), [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol)
*   **0x06 – RESP\_CODE\_SENT:** Indicates a message/request was sent into the mesh. Often includes a tracking ID or expected timeout. [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol)
*   **0x07 – RESP\_CODE\_CONTACT\_MSG\_RECV:** Incoming direct message (older protocol v1–2 format). [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol)
*   **0x08 – RESP\_CODE\_CHANNEL\_MSG\_RECV:** Incoming channel message (older format). [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol)
*   **0x09 – RESP\_CODE\_CURR\_TIME:** Current device time (4-byte timestamp). [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol)
*   **0x0A (10) – RESP\_CODE\_NO\_MORE\_MESSAGES:** No more messages in queue (reply to CMD\_SYNC\_NEXT\_MESSAGE if queue is empty). [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol)
*   **0x0B (11) – RESP\_CODE\_EXPORT\_CONTACT:** Contains a contact’s advert data (reply to CMD\_EXPORT\_CONTACT). [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol)
*   **0x0C (12) – RESP\_CODE\_BATT\_AND\_STORAGE:** Contains battery voltage and storage statistics (reply to CMD\_GET\_BATT\_AND\_STORAGE). [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol)
*   **0x0D (13) – RESP\_CODE\_DEVICE\_INFO:** Device info and capabilities (reply to CMD\_DEVICE\_QUERY). [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol), [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol)
*   **0x0E (14) – *\[possibly unused]*:** (No common definition; note 0x0F is also not used as a response code because 0x0F is used as an error code for “disabled” below).
*   **0x10 (16) – RESP\_CODE\_CONTACT\_MSG\_RECV\_V3:** Incoming direct message (newer protocol v3+ format). [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol)
*   **0x11 (17) – RESP\_CODE\_CHANNEL\_MSG\_RECV\_V3:** Incoming channel message (v3+ format). [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol)
*   **0x15 (21) – RESP\_CODE\_CUSTOM\_VARS:** Response with custom user-defined variables (reply to CMD\_GET\_CUSTOM\_VARS). [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol)
*   **0x16 (22) – RESP\_CODE\_ADVERT\_PATH:** Contains the last known advert path info for a contact (reply to CMD\_GET\_ADVERT\_PATH). [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol)
*   **0x18 (24) – RESP\_CODE\_STATS:** Returns device statistics data (reply to CMD\_GET\_STATS). [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol)
*   **0xFE (254) – RESP\_CODE\_BUSY:** (Hypothetical, not seen in above docs: some protocols use a busy code; MeshCore doesn’t list one explicitly, but it might use ERR if busy.)

And as mentioned, **0x15 (21 decimal)** is used as an *error frame code* to indicate a specific condition: in the code, `RESP_CODE_DISABLED (15)` means the requested operation is currently disabled. This is not a common occurrence unless the device has a mode that restricts certain commands.

The **push notification codes (0x80–0x8E)** cover events like login success/fail, incoming messages, new contact adverts, etc., and are documented in the Companion Protocol reference. They are not “requested” by the app but are emitted by the device as needed. [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol), [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol)

## MeshCore Device Types & Compatibility

MeshCore firmware comes in a few **roles (device types)** – primarily *Companion Radio*, *Repeater*, and *Room Server*. It’s important to identify which firmware your device is running, as it affects how you communicate with it:

*   **Companion Radio:** This is the firmware meant for user devices that connect to phones or PCs (via USB/BLE/WiFi). Companion nodes use the binary command protocol described above. If your device is a Companion, the command set and frames we’ve discussed apply. You will use commands like CMD\_DEVICE\_QUERY, etc., and get structured responses.

*   **Repeater and Room Server:** These are infrastructure nodes that usually don’t connect to an app in the same way. Instead of the binary API, they expose a **text-based CLI (command-line interface)** for configuration. For example, if you plug in a Repeater to USB and open a serial console, it won’t speak the frame protocol; rather, you might see a prompt or you can type commands (like `status`, `set freq`, etc.). *“Repeaters and room servers have their own built-in CLI accessible via USB/serial… This guide covers both the meshcore-cli tool for companion radios, and the serial CLI for repeaters and room servers.”*. In other words, **the binary commands (CMD\_\*) are mostly **not recognized** on a Repeater/Server firmware.** If you accidentally try a binary command on a repeater, you’ll likely either get no response or a simple error string. The presence of an *InvalidCommand* binary response (as  you got) actually suggests the device *did* recognize the frame structure – meaning it is likely a Companion (since a pure Repeater’s CLI wouldn’t even generate a structured binary error). So your device is probably a Companion with some compatibility issue, not a Repeater. If it were a repeater, you’d need to use the CLI text commands instead of the above protocol. [\[localmesh.nl\]](https://www.localmesh.nl/en/meshcore-cli-configuration/)

*   **Identification:** How to tell which firmware you have? One way is by **sending the Device Query** – a true Companion will respond with a structured info packet (or at least an error if it didn’t like the version). A Repeater/Server might not respond to that at all as a frame. Another way is to simply **open a terminal** to the COM port. If you see a welcome banner or `MeshCore>` prompt or can type `help` and get a response, it’s running the CLI (thus a Repeater/Server). If you see nothing, it’s likely a Companion waiting for binary commands. The fact that you got a binary `InvalidCommand` error strongly indicates a Companion firmware (since it responded in the binary format).

*   **Firmware Version Compatibility:** MeshCore’s protocol has evolved over time. The **protocol version** (as sent in CMD\_DEVICE\_QUERY) is used to handle differences between firmware versions. For example, *protocol v3* introduced new message formats (the RESP\_CODE\_CONTACT\_MSG\_RECV\_V3 etc.) and added fields like `max_contacts_div_2` in the device info. If you connect a newer app to an older firmware (or vice versa), some commands may not exist on the older side. Specifically, the **CMD\_DEVICE\_QUERY (0x16)** itself was introduced to facilitate version negotiation. Early versions of MeshCore (circa early 2025 or before) might not implement CMD\_DEVICE\_QUERY at all – those expected only CMD\_APP\_START to begin. If your device’s firmware is old and you send 0x16, it will return an “Invalid Command” error (since it doesn’t know that code). This seems likely in your case. On the flip side, a very new firmware might expect the query first and not respond properly to older sequences. The MeshCore documentation indicates the current firmware version code is 8 (with human version “v1.11.0” as of Nov 2025). If your device is running an earlier version (say v1.9 or v1.10), it could have a different command set. [\[deepwiki.com\]](https://deepwiki.com/meshcore-dev/MeshCore/4.1.1-command-protocol) [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol), [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol)

*   **Supported Commands per Firmware:** Generally, newer firmware supports all previous commands (for backward compatibility), and adds new ones. But some commands might be **inactive in certain builds** – for example, if a device has no BLE hardware, commands related to BLE (like retrieving a BLE PIN in the device info, or doing BLE operations) might return an error or zeros. Another example: not all firmware builds support custom variables or certain telemetry, so those commands might respond with `RESP_CODE_ERR` with an error code **Disabled** (meaning “feature not enabled”) – the code uses RESP\_CODE\_DISABLED (0x0F) in such cases. In the command table above, we see `CMD_GET_CUSTOM_VARS (0x28)` and `CMD_SET_CUSTOM_VAR (0x29)` – these might only function if custom vars feature is compiled in. If not, the device could respond with an error indicating the command is not available.

*   **Device Model Differences:** At the protocol level, different hardware models (T-Echo, T-Beam, etc.) running the *same Companion firmware* will behave identically in terms of commands. The differences will be reflected in the **Device Info** response (model name string, supported features bytes). For example, a device without a BLE radio might have a BLE PIN of 0 or a flag indicating no BLE. A device with an older microcontroller might have less memory for contacts (the `max_contacts_div_2` field would be lower). But you do not need a different command set per model – it’s unified by firmware version. Just be aware that **some commands query hardware-specific info**: e.g., battery level will only return meaningful data on devices with a battery ADC; on a device without battery it might return 0 or a fixed value.

*   **Common Command Recognition Issues:** Aside from the big distinction of companion vs repeater firmware, the most frequent causes of *InvalidCommand (0x01)* errors are:
    *   **Firmware too old/new for the command:** As noted, sending a command that wasn’t defined in the device’s firmware version will result in an error. For example, an older firmware (protocol v2) receiving CMD\_DEVICE\_QUERY (22) will likely respond with an error, as will a very old firmware if you sent a high-numbered command introduced later (like CMD\_SEND\_BINARY\_REQ, 0x32, if the firmware is from before binary requests were added).
    *   **Missing required payload data:** If the command format requires additional data and you send only the code with no payload, the firmware might treat it as malformed. In many cases, the device might still respond with a generic error. For instance, `CMD_SET_CUSTOM_VAR (0x29)` expects a name/value pair – if not provided, the device might return **ERR\_CODE\_ILLEGAL\_ARG** (through RESP\_CODE\_ERR). Always ensure you send the correct number of bytes as per the protocol spec. [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol)
    *   **Out-of-order initialization:** Some devices might require **CMD\_APP\_START** before other commands will be processed. If you skip APP\_START and jump into something else on a firmware that expects it, you could get an error. (Most modern firmware doesn’t strictly enforce this, but the documentation emphasis suggests it for proper setup.) [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol)
    *   **Feature not enabled:** Some commands are only valid if a feature is turned on. For example, if custom variables or certain experimental features are disabled in the firmware build, their commands might return a RESP\_CODE\_ERR with a “Disabled” error. Another example: trying a network command like CMD\_SEND\_LOGIN on a device that isn’t configured for any server might just return an error immediately.
    *   **Communication framing issues:** Less common, but if the length byte is wrong or the frame is malformed, the device might not parse the command correctly. It could result in no response or an unpredictable error. Given that you **did** get a structured error, your framing was likely correct. Just ensure the length bytes you send correspond to the payload length (excluding the start and length bytes themselves).

## Troubleshooting ‘InvalidCommand’ Errors and Unknown Devices

Seeing an **‘InvalidCommand’ status (error code 0x01)** in response to a command like CMD\_DEVICE\_QUERY indicates the device received your frame but didn’t recognize the command code. Here’s a systematic approach to troubleshoot and ultimately find a working command:

1.  **Verify Frame Formatting:** Since you got a response, the framing (start byte and length) is probably correct. Just double-check that for each command you send, you include the proper start delimiter (0x3C for commands), the little-endian length, and the full payload. A mismatched length could lead to mis-parsed commands. (In your case, the device clearly parsed something and responded, so this is likely fine.)

2.  **Try the Alternate Handshake:** If **CMD\_DEVICE\_QUERY (22)** returns invalid, the device might be running an older protocol. Immediately try sending **CMD\_APP\_START (1)** as the first command instead. Format: start with 0x3C, length = 1 (for just the command code, if you don’t want to send app name yet, or length = 1+N if including a name), payload = `0x01` (and maybe an app version byte and dummy name if required). The device should respond with **RESP\_CODE\_SELF\_INFO (5)** if it supports that command. For example, you could send 0x3C 0x01 0x00 0x01 – a minimal App Start indicating version 0 – and see if you get a response. If you do get a Self Info (code 5) response, then you know the device speaks an older protocol (and you have its basic node info). After that, it may start accepting other commands. Some older firmware actually required APP\_START before DEVICE\_QUERY, so after a successful APP\_START, try Device Query again – it might then succeed in returning Device Info. Essentially, **perform both handshake commands** in different orders to see what the device expects. [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol)

3.  **Inspect the Error Code:** The error response payload has an error subcode. If you have the raw bytes from the InvalidCommand response, check the second byte (after 0x01). If it is `0x01`, that likely denotes “Unknown Command.” If it were `0x02`, it would mean “Illegal Argument” or similar (the command was recognized but something was off with parameters). Knowing this can confirm whether the command code itself was not understood versus a payload issue. In your case it sounds like an unrecognized command (which aligns with an older firmware not knowing code 22).

4.  **Use Basic Commands to Probe:** Try a very simple, universally supported command to see if the device responds. A good one is **CMD\_GET\_DEVICE\_TIME (5)** – nearly all devices (even old versions) have this. Send `<3C> 0x01 0x00 0x05`. If the device responds with a 0x09 frame containing 4 bytes of data, then the protocol is active and working. If even that returns InvalidCommand, something is very off (since GET\_DEVICE\_TIME has been around since early versions). Similarly, **CMD\_GET\_BATT\_AND\_STORAGE (0x14)** could be tried – if the device has that feature it will return 0x0C with data, otherwise maybe an error. The idea is to find at least one command it will accept. Often, 0x05 and 0x01 are safe bets on any version. [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol)

5.  **Check Firmware Mode:** Ensure the device is indeed running Companion firmware. Clues to this:
    *   Companion will never print human-readable prompts on serial by itself. If you see none, that’s a good sign.
    *   The device query (once working) or self info will include a **“manufacturer\_model”** string – e.g., “T-Beam SX1262” or “LORA32v2.1”. That tells you the hardware. It might also include a “semantic\_version” like “v1.9.0” which tells you firmware version. [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol)
    *   If the device were a repeater, connecting at 115200 and hitting Enter might show a `>` prompt or some text. The absence of that suggests it’s a Companion waiting for binary frames.

6.  **Update Firmware if Possible:** If you identify that the device firmware is old (say the Device Info comes back and shows a build date in early 2025 or a version <1.11), consider updating to the latest MeshCore firmware. Newer firmware will support CMD\_DEVICE\_QUERY and other commands, and generally have more features and bug fixes. MeshCore provides pre-built binaries for various boards (as noted by LilyGO’s guide). Flashing the latest **Companion** firmware could resolve the InvalidCommand issue by bringing the command set up-to-date. Just ensure you flash the correct type (Companion vs Repeater) for your use case. [\[wiki.lilygo.cc\]](https://wiki.lilygo.cc/get_started/en/Meshcore/meshcore.html), [\[wiki.lilygo.cc\]](https://wiki.lilygo.cc/get_started/en/Meshcore/meshcore.html)

7.  **Consult Documentation for New/Alternate Commands:** The question of “are there alternative commands like ‘ping’, ‘hello’, or ‘get\_info’?” – We interpret that as *did we possibly use the wrong command for device identification*. In MeshCore, the **Device Query (22)** is effectively the “get\_info” command. There isn’t a command literally called “ping” or “hello” – instead, any command can serve as a connectivity test (if it returns something). The device query is the closest to a “get\_info”. There is also no generic “ping” that simply returns an ack without doing anything; you’d just use a small info command as a ping. So, if CMD\_DEVICE\_QUERY wasn’t working, **CMD\_APP\_START** was the alternative “hello” to try. You’ve covered those now. Another related command is **CMD\_HAS\_CONNECTION (0x1C)** which sounds like a ping, but that is specifically to check connection to a server, not relevant for just PC-device link. So in summary, no other secret “ping” command exists beyond using the known ones. Focus on getting device info via 0x01 or 0x16.

8.  **Enumerating Supported Commands:** If you really had an unknown device and wanted to discover supported commands without documentation, you might attempt a brute-force scan: systematically send every code 0x01 through 0x38 (and other ranges) and see which return RESP\_CODE\_OK vs RESP\_CODE\_ERR. However, *extreme caution*: some commands perform actions (reboots, resets, transmitting on radio) – you wouldn’t want to accidentally factory reset (0x33) or send bogus data. If you limit to non-destructive queries (like 0x05, 0x0A, 0x0B, etc.), you could map out what’s recognized. But given we have the documentation, it’s better to use that. **Device Info response is the best indicator**: it will implicitly tell you version, and from version you know which commands are available (e.g., if firmware\_ver byte <3, then CMD\_DEVICE\_QUERY wasn’t originally in that version). The `firmware_ver` field in RESP\_CODE\_DEVICE\_INFO is an internal code (possibly matching FIRMWARE\_VER\_CODE). In current devices it might be 8. If yours is, say, 6 or 7, that tells you it’s older. [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol), [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol)

9.  **No Response At All:** If at any point you get *no response*, consider that the device might have rebooted or crashed. The absence of a 0x3E frame could mean the command wasn’t processed. This could happen if, for instance, the command caused a crash (unlikely with these simple ones) or if the serial communication is somehow not reaching the device. Double-check cables and that the device is powered. But since you are getting error responses, communication is established.

In practice, **the solution for your scenario** (where `CMD_DEVICE_QUERY (22)` returns invalid) will likely be: **send `CMD_APP_START (1)` first**, receive the Self Info (code 5). Then send `CMD_DEVICE_QUERY (22)` and this time it may succeed (some users have found that the device needed App Start before it would return Device Info). If it still fails, your firmware might truly not implement 22 at all – in that case rely on the Self Info and perhaps other commands to gather what you need. You might also try commanding a **soft reboot (CMD\_REBOOT, 0x13)** and see if on reconnection it behaves differently (for example, some very early versions had Device Info accessible via a text CLI command rather than binary, but that’s unlikely here).

Finally, ensure you are using the **latest PC-side library or tool** if one is available. The MeshCore Python API (`meshcore.py`) or CLI tool might abstract these handshake details for you. Using an official client can eliminate guesswork – e.g., the Python library might automatically send both handshake commands and parse whatever comes, hiding the differences. If you continue manually, though, the steps above and the command tables should help you find a working command and get the device talking correctly.

**In summary:** MeshCore’s protocol requires an initial handshake (Device Query and/or App Start) to exchange capabilities. The communication is done with framed binary messages over serial (0x3C/0x3E delimiters, length, payload). A wide range of commands (0x01–0x38, 0x50+, etc.) are available for various functions, and each has a corresponding response (or simple ACK). If you see `InvalidCommand` errors, adjust your approach according to the device’s expected sequence or firmware limits – often the fix is to start with the proper handshake or update the firmware. With a correct sequence, you should be able to query the device for its info and then use other commands (like time, battery, messaging) successfully. The provided tables and examples above give you the exact byte values and formats for known commands, which should greatly aid in crafting the correct serial messages for MeshCore devices. Good luck with your MeshCore device communication! [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol) [\[deepwiki.com\]](https://deepwiki.com/meshcore-dev/MeshCore/4.1.1-command-protocol) [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol), [\[github.com\]](https://github.com/meshcore-dev/MeshCore/wiki/Companion-Radio-Protocol)
